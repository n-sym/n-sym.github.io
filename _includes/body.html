<div class="page-wrapper" tabindex="-1" role="main">
    {% if page.cover %}
        <img src="{{ page.cover }}"
             width="100%"
             height="{{ page.cover_height | default: '100%' }}"
             alt="{{ page.title | escape }}"
             style="object-fit: cover;"
        />
    {% endif %}

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    {% if page.title %}
                        <h1 id="{{ page.id }}">{{ page.title | escape }}</h1>
                    {% else %}
                        <h1 id="{{ page.id }}">{{ site.title | escape }}</h1>
                    {% endif %}

                    {{ content }}

                    {%- if jekyll.environment != 'dev' and site.disqushandler -%}
                        {%- include disqus.html -%}
                    {%- endif -%}
                </section>
            </div>

            {%- include search.html -%}
        </div>
    </div>
</div>


<script>
    function addTitleListener() {
        const header = document.querySelector('.book-header');
        const mainTitle = document.querySelector('.normal.markdown-section h1');
        if (!header || !mainTitle) {
            return;
        }

        const observerCallback = (entries) => {
            entries.forEach(entry => {
            if (entry.isIntersecting) {
                header.classList.remove('title-visible');
            } else {
                header.classList.add('title-visible');
            }
            console.log(entry);
            });
        };
        const observerOptions = {
            root: null,
            threshold: 0,
            rootMargin: "-70px 0px 0px 0px"
        };
        const observer = new IntersectionObserver(observerCallback, observerOptions);
        observer.observe(mainTitle);
    }
    if (document.readyState === "loading") {
        // Loading hasn't finished yet
        document.addEventListener("DOMContentLoaded", addTitleListener);
    } else {
        // `DOMContentLoaded` has already fired
        addTitleListener();
    }
</script>
<!-- introduce per-page mermaid support -->
{% if page.mermaid %}
    {% include mermaid.html %}
{% else %}
<!-- introduce mathjax support -->
    {% include mathjax.html %}
{% endif %}

<!-- introduce mathjax support -->
{% include fixes-chrome-anchors.html %}